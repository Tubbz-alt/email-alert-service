#!/usr/bin/env ruby

require "byebug"

require_relative "../email_alert_service/config"
config = EmailAlertService::Config.new(ENV["ENVIRONMENT"])

[config.app_root, config.app_root+"email_alert_service"].each do |path|
  $LOAD_PATH << path.to_s
end

require 'logger'
logfile = File.open(config.app_root+"log/#{config.environment}.log", 'a')
logger = Logger.new(logfile, 'daily')
logger.level = Logger::DEBUG
logfile.sync = true
$stderr = $stdout = logfile

require "listeners/major_change_listener"
listener = MajorChangeListener.new(config.rabbitmq)

at_exit do
  puts "Shutting down.."
  listener.stop
end

listener.run
