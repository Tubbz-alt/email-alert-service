#!/usr/bin/env ruby

require_relative "../email_alert_service/environment"

require "listeners/major_change_listener"
listener = MajorChangeListener.new(
  EmailAlertService.config.rabbitmq,
  EmailAlertService.config.logger
)

at_exit do
  puts "Shutting down.."
  listener.stop
end

begin
  listener.start
rescue Exception => e
  Airbrake.notify_or_ignore(e)
  raise e
end
